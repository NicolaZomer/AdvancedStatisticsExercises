---
title: "Exercises Laboratory Session 01"
author: "Nicola Zomer"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_notebook
---

```{r}
library(glue)
library(ggplot2)
library(scales)
library(latex2exp)
```

# Exercise 1 - Vectors and data frames

```{r}
lakes <- read.csv("../data/lochs_of_Scotland.csv", header=TRUE, sep=",")
lakes
```

```{r}
# Remove columns not containing volume or area and in [mi]
lakes <- lakes[, c(1, 2, 4)]

# Rename the columns
colnames(lakes) <- c('Loch', 'Volume', 'Area')
lakes

```

## 1. Evaluate the highest and lowest volume and area lake

```{r}
# indices 
idx_max_vol <- which.max(lakes$Volume)
idx_min_vol <- which.min(lakes$Volume)
idx_max_area <- which.max(lakes$Area)
idx_min_area <- which.min(lakes$Area)

# results 

cat(
  'Highest volume lake:', lakes$Loch[idx_max_vol], ', with volume ', lakes$Volume[idx_max_vol], 'km^3\n',
  'Lowest volume lake:', lakes$Loch[idx_min_vol], ', with volume ', lakes$Volume[idx_min_vol], 'km^3\n', 
  'Highest area lake:', lakes$Loch[idx_max_area], ', with area ', lakes$Area[idx_max_area], 'km^2\n',
  'Lowest area lake:', lakes$Loch[idx_min_area], ', with area ', lakes$Area[idx_min_area], 'km^2'
  
  )
```

## 2. Order the frame with respect to the area and determine the two largest area lakes

Ordered dataframe:

```{r}
lakes_byarea <- lakes[order(lakes$Area, decreasing=TRUE), ]
lakes_byarea 
```

```{r}
largest_area_2 = lakes_byarea$Loch[1:2]

glue('2 largest area lakes: {largest_area_2[1]} and {largest_area_2[2]}')
```

## 3. By summing up the areas occupied by the lakes, determine the area of Scotland covered by water

```{r}
area_water <- sum(lakes$Area)
glue('Area of Scotland covered by water: {area_water} km^2')

```

Reference and data: <https://en.wikipedia.org/wiki/List_of_lochs_of_Scotland>

# Exercise 2 - Crude Oil Production

## 1. Write R code that is able to read the file and import it in a data frame structure

The last column of the data frame contains data on crude oil prices from 1861 to 2020, measured in US dollars per barrel.

```{r}
oil_prices <- read.csv("../data/crude-oil-prices.csv", header=TRUE, sep=",")
colnames(oil_prices) <- c(names(oil_prices[1:3]), 'Price') 

oil_prices

```

## 2. Produce a plot with the Oil price as a function of the year

```{r}
gg <- ggplot(oil_prices, aes(x=Year, y=Price))+
  geom_point(col='navyblue') + 
  labs(title="Crude Oil Prices from 1861 to 2020 ($/barrel)", 
       y="Price",
       x='Year', 
       caption = "Source: https://ourworldindata.org/grapher/crude-oil-prices") +
  scale_y_continuous(
    breaks = seq(0, 120, 15),
    minor_breaks = NULL
  ) + 
  scale_x_continuous(
    breaks = seq(1850, 2050, 25),
    minor_breaks = NULL,
    limits=c(1850, 2025)
  )

plot(gg)
```

## 3. Which is the highest price in history ? When did it occur ?

```{r}
highest_price <- max(oil_prices$Price)
highest_price_year <- oil_prices$Year[which.max(oil_prices$Price)]

glue('Highest price in hystory: {format(highest_price, digits=5)} $/barrel.\n
  It occured in {highest_price_year}.')
```

## 4. Plot the derivative of the curve, simply evaluated with the finite difference formula

$$
\frac{\partial price}{\partial year} = price_{j+1}-price{j}
$$

```{r}
prices <- oil_prices$Price
years <- oil_prices$Year
derivatives <- prices[2:length(prices)]-prices[1:length(prices)-1]

df_derivatives <- data.frame(years[1:length(years)-1], derivatives)
colnames(df_derivatives) <- c('Year', 'Derivative')

head(df_derivatives)


```

```{r}
gg <- ggplot(df_derivatives, aes(x=Year, y=Derivative))+
  geom_point(col='navyblue') + 
  labs(title="Annual Variation of Crude Oil Prices from 1861 to 2020 ($/barrel)", 
       y=TeX("$\\Delta$Price"),
       x='Year', 
       caption = "Source: https://ourworldindata.org/grapher/crude-oil-prices") +
  scale_x_continuous(
    breaks = seq(1850, 2050, 25),
    minor_breaks = NULL,
    limits=c(1850, 2025)
  ) +
  scale_y_continuous(
    breaks = seq(-45, 45, 15),
    minor_breaks = NULL,
  )

plot(gg)
```

Reference and data: <https://ourworldindata.org/grapher/crude-oil-prices>

# Exercise 3 - World Coal Production

## 1. Write R code that is able to read the file and import it in a tibble structure

```{r}
TeX("$\\Delta$ Price")

```

## 2. Count the number of countries available in the file and produce a barplot with the number of entries for each country

## 3. Selecting only the year after 1970, determine the total integrated production for each country and print the top 5 countries with highest coal productions

## 4. For the 5 top Countries, create a plot of production as a function of time

## 5. Generate a plot with the cumulative sum of the World's coal production over the years

Reference and data: <https://ourworldindata.org/grapher/coal-production-by-country>

# Exercise 4 - Covid19 Vaccine data

## File 'vaccinations-by-manufacturer.csv'

### 1. Filter() the original tibble by selecting the following countries: Italy

### 2. Plot the number of vaccines given as a function of time for the different vaccine manufacturer

### 3. From the same tibble plot the total number of vaccines shot per day in Italy

### 4. Do the same exercise for the following countries: Germany and United States of America

Data: <https://github.com/owid/covid-19-data/blob/master/public/data/vaccinations/vaccinations-by-manufacturer.csv>

## File 'vaccinations.csv'

### 1. Selecting all the European countries in the tibble, plot the number of daily vaccinations per million as a function of date

### 2. Study the data structure and produce few relevant plots of your taste

Data: <https://github.com/owid/covid-19-data/blob/master/public/data/vaccinations/vaccinations.csv>

## 
